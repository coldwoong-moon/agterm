# AgTerm Agent Orchestration UI ê°œì„  ê³„íš

> v1.1 ì™„ë£Œ í›„ ì—ì´ì „íŠ¸ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ì— ìµœì í™”ëœ UI/UX ê°œì„  ë¡œë“œë§µ

---

## í˜„ì¬ ìƒíƒœ (v1.1 ì™„ë£Œ)

### êµ¬í˜„ ì™„ë£Œ
| ì»´í¬ë„ŒíŠ¸ | ìƒíƒœ | ì„¤ëª… |
|---------|------|------|
| MCP Panel | âœ… | ì—ì´ì „íŠ¸ ì„ íƒ, ë„êµ¬ ëª©ë¡, ì—°ê²° ìƒíƒœ |
| AI Block | âœ… | Thinking/Response/Command/Error ë¸”ë¡ |
| AsyncBridge | âœ… | Floem â†” Tokio ë¹„ë™ê¸° í†µì‹  |
| Command Validator | âœ… | ìœ„í—˜ë„ í‰ê°€ (Low/Medium/High/Critical) |
| ê²€ìƒ‰ UI | âœ… | ëŒ€ì†Œë¬¸ì, ì •ê·œì‹ í† ê¸€ |
| MCP ë¦¬ì‚¬ì´ì¦ˆ | âœ… | ë“œë˜ê·¸ ê°€ëŠ¥í•œ divider |

### ê°œì„  í•„ìš”
| ì˜ì—­ | í˜„ì¬ ìƒíƒœ | ê°œì„  ë°©í–¥ |
|------|----------|----------|
| ì—ì´ì „íŠ¸ ê´€ë¦¬ | Enum ê³ ì • | ë™ì  Registry |
| ë„êµ¬ ì…ë ¥ | ì—†ìŒ | ìŠ¤í‚¤ë§ˆ ê¸°ë°˜ í¼ |
| ì‹¤í–‰ íŒŒì´í”„ë¼ì¸ | ë‹¨ìˆœ ì „ì†¡ | ìƒíƒœ ë¨¸ì‹  ê¸°ë°˜ |
| íˆìŠ¤í† ë¦¬ | ì—†ìŒ | ì„¸ì…˜ ì €ì¥/ë³µì› |
| ë©€í‹° ì—ì´ì „íŠ¸ | ì—†ìŒ | ë™ì‹œ ì—°ê²° ì§€ì› |

---

## ëª©í‘œ: Agentic Terminal

AgTermì„ **AI ì—ì´ì „íŠ¸ê°€ í„°ë¯¸ë„ì„ íš¨ê³¼ì ìœ¼ë¡œ ì œì–´**í•  ìˆ˜ ìˆëŠ” ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ í”Œë«í¼ìœ¼ë¡œ ì§„í™”

### í•µì‹¬ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

```
1. ê°œë°œìê°€ Claude Codeë¥¼ AgTermì— ì—°ê²°
2. Claudeê°€ ì½”ë“œ ìˆ˜ì •/í…ŒìŠ¤íŠ¸ ëª…ë ¹ì„ ì œì•ˆ
3. AgTermì´ ìœ„í—˜ë„ í‰ê°€ ë° ì‹œê°í™”
4. ê°œë°œìê°€ ìŠ¹ì¸/ìˆ˜ì • í›„ ì‹¤í–‰
5. ê²°ê³¼ê°€ Claudeì—ê²Œ í”¼ë“œë°±
6. ë°˜ë³µ...
```

---

## Phase G: Agent Dashboard (1ì£¼)

### G.1 Agent Registry êµ¬í˜„

**ëª©í‘œ**: ê³ ì •ëœ 4ê°œ ì—ì´ì „íŠ¸ â†’ ë™ì  ê´€ë¦¬

```rust
// src/floem_app/agent_registry.rs

pub struct AgentConfig {
    pub id: String,
    pub name: String,
    pub command: String,
    pub args: Vec<String>,
    pub icon: Option<String>,
    pub color: Color,
    pub capabilities: Vec<String>,
}

pub struct AgentRegistry {
    pub agents: RwSignal<Vec<AgentConfig>>,
    pub active_connections: RwSignal<HashMap<String, ConnectionState>>,
}

impl AgentRegistry {
    /// ê¸°ë³¸ ì—ì´ì „íŠ¸ ë¡œë“œ
    pub fn load_defaults(&self) { ... }

    /// ì‚¬ìš©ì ì •ì˜ ì—ì´ì „íŠ¸ ì¶”ê°€
    pub fn add_custom(&self, config: AgentConfig) { ... }

    /// ì„¤ì • íŒŒì¼ì—ì„œ ë¡œë“œ
    pub fn load_from_config(&self, path: &Path) { ... }
}
```

**ì„¤ì • íŒŒì¼ í˜•ì‹** (`~/.config/agterm/agents.toml`):
```toml
[[agents]]
id = "claude_code"
name = "Claude Code"
command = "claude"
args = ["--mcp-server"]
color = "#7C3AED"
capabilities = ["code", "shell", "file"]

[[agents]]
id = "custom_agent"
name = "My Custom Agent"
command = "/path/to/agent"
args = ["--mcp"]
color = "#10B981"
```

### G.2 Agent Dashboard View

**ëª©í‘œ**: ì—°ê²°ëœ ì—ì´ì „íŠ¸ ìƒíƒœë¥¼ í•œëˆˆì— íŒŒì•…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤– Agent Dashboard                            [Ã—]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ ğŸŸ¢ Claude   â”‚ â”‚ ğŸ”´ Gemini   â”‚ â”‚ âšª Custom   â”‚    â”‚
â”‚ â”‚ Connected   â”‚ â”‚ Disconnectedâ”‚ â”‚ Not Config  â”‚    â”‚
â”‚ â”‚ 15 tools    â”‚ â”‚ [Connect]   â”‚ â”‚ [Setup]     â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Active Session: Claude Code                         â”‚
â”‚ â”œâ”€ Tools: 15 available                             â”‚
â”‚ â”œâ”€ Commands: 8 pending approval                    â”‚
â”‚ â””â”€ History: 23 executed today                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ìƒˆ íŒŒì¼**: `src/floem_app/views/agent_dashboard.rs`

### G.3 Connection State Machine

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    Idle      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ connect()
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Connecting  â”‚â”€â”€â”€â”€ timeout â”€â”€â”€â”€â”
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
                           â”‚ initialized             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
              â”Œâ”€â”€â”€â”€â”€â”‚  Connected   â”‚                 â”‚
              â”‚     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
    list_toolsâ”‚            â”‚ error                   â”‚
              â”‚     â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
              â””â”€â”€â”€â”€â–ºâ”‚   Ready      â”‚          â”‚    Error     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Phase H: Command Pipeline (1ì£¼)

### H.1 Execution Pipeline êµ¬í˜„

**ëª©í‘œ**: ëª…ë ¹ ì‹¤í–‰ ì „ ê²€ì¦/ìŠ¹ì¸/ì¶”ì 

```rust
// src/floem_app/execution_pipeline.rs

pub enum PipelineStage {
    Received,       // ì—ì´ì „íŠ¸ë¡œë¶€í„° ìˆ˜ì‹ 
    Validated,      // ìœ„í—˜ë„ í‰ê°€ ì™„ë£Œ
    PendingApproval,// ì‚¬ìš©ì ìŠ¹ì¸ ëŒ€ê¸°
    Approved,       // ìŠ¹ì¸ë¨
    Executing,      // ì‹¤í–‰ ì¤‘
    Completed,      // ì™„ë£Œ
    Failed,         // ì‹¤íŒ¨
    Cancelled,      // ì·¨ì†Œë¨
}

pub struct PipelineItem {
    pub id: Uuid,
    pub agent_id: String,
    pub command: String,
    pub risk_level: RiskLevel,
    pub stage: RwSignal<PipelineStage>,
    pub created_at: DateTime<Utc>,
    pub output: RwSignal<Option<String>>,
}

pub struct ExecutionPipeline {
    pub items: RwSignal<Vec<PipelineItem>>,
    pub auto_approve_level: RwSignal<RiskLevel>,
}

impl ExecutionPipeline {
    /// ìƒˆ ëª…ë ¹ ì¶”ê°€
    pub fn enqueue(&self, agent_id: &str, command: &str) -> Uuid { ... }

    /// ìë™ ìŠ¹ì¸ ì²˜ë¦¬
    pub fn process_auto_approvals(&self) { ... }

    /// ìˆ˜ë™ ìŠ¹ì¸
    pub fn approve(&self, id: Uuid) { ... }

    /// ìˆ˜ë™ ê±°ë¶€
    pub fn reject(&self, id: Uuid) { ... }

    /// ëª…ë ¹ ìˆ˜ì • í›„ ìŠ¹ì¸
    pub fn approve_modified(&self, id: Uuid, new_command: &str) { ... }
}
```

### H.2 Command Queue View

**ëª©í‘œ**: ëŒ€ê¸° ì¤‘ì¸ ëª…ë ¹ ëª©ë¡ ë° ìŠ¹ì¸/ê±°ë¶€ UI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ Command Queue                    Auto: Low [â–¼]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸŸ¡ MEDIUM  git push origin main                 â”‚ â”‚
â”‚ â”‚ from: Claude Code                               â”‚ â”‚
â”‚ â”‚ [âœ“ Approve] [âœ Edit] [âœ— Reject]                â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ”´ HIGH    rm -rf node_modules                  â”‚ â”‚
â”‚ â”‚ from: Claude Code                               â”‚ â”‚
â”‚ â”‚ âš ï¸ This will delete 1.2GB of files              â”‚ â”‚
â”‚ â”‚ [âœ“ Approve] [âœ Edit] [âœ— Reject]                â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸŸ¢ LOW     ls -la                    [Auto âœ“]   â”‚ â”‚
â”‚ â”‚ Executing...                                    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ìƒˆ íŒŒì¼**: `src/floem_app/views/command_queue.rs`

### H.3 Approval Settings

```toml
# ~/.config/agterm/config.toml

[agent_orchestration]
auto_approve_level = "low"  # low, medium, high, never
require_confirmation_for = ["rm", "sudo", "git push"]
blocked_patterns = ["rm -rf /", ":(){ :|:& };:"]
```

---

## Phase I: Context & History (1ì£¼)

### I.1 Execution History

**ëª©í‘œ**: ì‹¤í–‰ëœ ëª…ë ¹ íˆìŠ¤í† ë¦¬ ì €ì¥ ë° ì¡°íšŒ

```rust
// src/floem_app/execution_history.rs

pub struct HistoryEntry {
    pub id: Uuid,
    pub agent_id: String,
    pub command: String,
    pub risk_level: RiskLevel,
    pub executed_at: DateTime<Utc>,
    pub duration_ms: u64,
    pub exit_code: Option<i32>,
    pub output_preview: String,
    pub full_output_path: PathBuf,
}

pub struct ExecutionHistory {
    pub entries: RwSignal<Vec<HistoryEntry>>,
    pub db: SqliteConnection,  // ì˜êµ¬ ì €ì¥
}

impl ExecutionHistory {
    /// íˆìŠ¤í† ë¦¬ ì¶”ê°€
    pub fn add(&self, entry: HistoryEntry) { ... }

    /// ê²€ìƒ‰
    pub fn search(&self, query: &str) -> Vec<HistoryEntry> { ... }

    /// ë‚ ì§œë³„ ì¡°íšŒ
    pub fn by_date(&self, date: NaiveDate) -> Vec<HistoryEntry> { ... }

    /// ì—ì´ì „íŠ¸ë³„ ì¡°íšŒ
    pub fn by_agent(&self, agent_id: &str) -> Vec<HistoryEntry> { ... }

    /// ì¬ì‹¤í–‰
    pub fn replay(&self, id: Uuid) { ... }
}
```

### I.2 History View

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“œ History                         [ğŸ” Search...]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Today (23 commands)                                 â”‚
â”‚ â”œâ”€ 14:32 â”‚ ls -la          â”‚ âœ… 0   â”‚ 12ms â”‚ [â–¶]  â”‚
â”‚ â”œâ”€ 14:31 â”‚ npm test        â”‚ âœ… 0   â”‚ 4.2s â”‚ [â–¶]  â”‚
â”‚ â”œâ”€ 14:28 â”‚ git status      â”‚ âœ… 0   â”‚ 89ms â”‚ [â–¶]  â”‚
â”‚ â””â”€ 14:25 â”‚ cargo build     â”‚ âŒ 101 â”‚ 12s  â”‚ [â–¶]  â”‚
â”‚                                                     â”‚
â”‚ Yesterday (45 commands)                             â”‚
â”‚ â””â”€ [Expand]                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### I.3 Context Inspector

**ëª©í‘œ**: ì—ì´ì „íŠ¸ì—ê²Œ ì œê³µë˜ëŠ” ì»¨í…ìŠ¤íŠ¸ ì‹œê°í™”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” Context Inspector                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Terminal State                                      â”‚
â”‚ â”œâ”€ CWD: /Users/dev/project                         â”‚
â”‚ â”œâ”€ Shell: zsh                                       â”‚
â”‚ â”œâ”€ Last Command: npm test                          â”‚
â”‚ â””â”€ Last Exit Code: 0                               â”‚
â”‚                                                     â”‚
â”‚ Environment                                         â”‚
â”‚ â”œâ”€ NODE_ENV: development                           â”‚
â”‚ â”œâ”€ PATH: /usr/local/bin:...                        â”‚
â”‚ â””â”€ [Show All]                                       â”‚
â”‚                                                     â”‚
â”‚ Recent Output (last 50 lines)                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ > npm test                                      â”‚ â”‚
â”‚ â”‚ PASS src/test.js                                â”‚ â”‚
â”‚ â”‚ Tests: 12 passed, 12 total                      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Phase J: Multi-Agent Support (1ì£¼)

### J.1 Multi-Connection Manager

**ëª©í‘œ**: ì—¬ëŸ¬ ì—ì´ì „íŠ¸ ë™ì‹œ ì—°ê²°

```rust
pub struct MultiAgentManager {
    pub connections: RwSignal<HashMap<String, McpClient>>,
    pub primary_agent: RwSignal<Option<String>>,
}

impl MultiAgentManager {
    /// ì—ì´ì „íŠ¸ ì—°ê²°
    pub async fn connect(&self, agent_id: &str) -> Result<(), McpError> { ... }

    /// ì£¼ ì—ì´ì „íŠ¸ ì„¤ì •
    pub fn set_primary(&self, agent_id: &str) { ... }

    /// ëª¨ë“  ì—ì´ì „íŠ¸ì— ë¸Œë¡œë“œìºìŠ¤íŠ¸
    pub async fn broadcast(&self, message: &str) { ... }

    /// íŠ¹ì • ì—ì´ì „íŠ¸ì— ë„êµ¬ í˜¸ì¶œ
    pub async fn call_tool(&self, agent_id: &str, tool: &str, params: Value) { ... }
}
```

### J.2 Agent Tabs/Split View

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Claude Code â–¼] [Gemini CLI] [+ Add Agent]          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Claude Code       â”‚ â”‚ Terminal                  â”‚ â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚ â”‚ Tools: 15        â”‚ â”‚ $ npm test                â”‚ â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚ PASS src/test.js          â”‚ â”‚
â”‚ â”‚ [AI Response]    â”‚ â”‚ Tests: 12 passed          â”‚ â”‚
â”‚ â”‚                  â”‚ â”‚                           â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### J.3 Agent Chaining

**ëª©í‘œ**: í•œ ì—ì´ì „íŠ¸ì˜ ì¶œë ¥ì„ ë‹¤ë¥¸ ì—ì´ì „íŠ¸ì˜ ì…ë ¥ìœ¼ë¡œ

```rust
pub struct AgentChain {
    pub steps: Vec<ChainStep>,
}

pub struct ChainStep {
    pub agent_id: String,
    pub tool_name: String,
    pub input_mapping: InputMapping,
}

pub enum InputMapping {
    Static(Value),              // ê³ ì • ê°’
    FromPrevious,               // ì´ì „ ê²°ê³¼ ì „ì²´
    FromPreviousField(String),  // ì´ì „ ê²°ê³¼ì˜ íŠ¹ì • í•„ë“œ
    FromTerminal,               // í„°ë¯¸ë„ ì¶œë ¥
}
```

---

## Phase K: Advanced UI (1ì£¼)

### K.1 Tool Parameter Form

**ëª©í‘œ**: MCP ë„êµ¬ì˜ ì…ë ¥ ìŠ¤í‚¤ë§ˆ ê¸°ë°˜ ìë™ í¼ ìƒì„±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”§ run_command                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Command *                                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ npm run build                                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                     â”‚
â”‚ Working Directory                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ /Users/dev/project                       [ğŸ“]  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                     â”‚
â”‚ Timeout (seconds)                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 30                                              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                     â”‚
â”‚                              [Cancel] [Execute]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ìƒˆ íŒŒì¼**: `src/floem_app/views/tool_form.rs`

### K.2 Streaming Response View

**ëª©í‘œ**: ì—ì´ì „íŠ¸ ì‘ë‹µì„ ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤– Claude is thinking...                    [Stop]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–ŒI'll analyze the error in your code.              â”‚
â”‚                                                     â”‚
â”‚ The issue appears to be in line 42 where you're    â”‚
â”‚ calling `unwrap()` on a `None` value. Here's the   â”‚
â”‚ fix:                                                â”‚
â”‚                                                     â”‚
â”‚ ```rust                                             â”‚
â”‚ if let Some(value) = result {                      â”‚
â”‚     // handle value                                 â”‚
â”‚ }â–ˆ                                                  â”‚
â”‚ ```                                                 â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ Tokens: 127 | Elapsed: 2.3s                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### K.3 Split MCP Panel Modes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ View Mode: [Dashboard] [Queue] [History] [Context]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚           (ê° ëª¨ë“œë³„ ë‚´ìš©)                           â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## íŒŒì¼ êµ¬ì¡° ë³€ê²½

### ìƒˆ íŒŒì¼
```
src/floem_app/
â”œâ”€â”€ agent_registry.rs       # Phase G
â”œâ”€â”€ execution_pipeline.rs   # Phase H
â”œâ”€â”€ execution_history.rs    # Phase I
â”œâ”€â”€ multi_agent.rs          # Phase J
â””â”€â”€ views/
    â”œâ”€â”€ agent_dashboard.rs  # Phase G
    â”œâ”€â”€ command_queue.rs    # Phase H
    â”œâ”€â”€ history_view.rs     # Phase I
    â”œâ”€â”€ context_inspector.rs # Phase I
    â”œâ”€â”€ tool_form.rs        # Phase K
    â””â”€â”€ streaming_view.rs   # Phase K
```

### ìˆ˜ì • íŒŒì¼
| íŒŒì¼ | ë³€ê²½ ë‚´ìš© |
|------|----------|
| `mod.rs` | ìƒˆ ëª¨ë“ˆ ë“±ë¡, ë·° ëª¨ë“œ ì „í™˜ |
| `state.rs` | AgentRegistry, Pipeline í†µí•© |
| `mcp_panel.rs` | ë·° ëª¨ë“œ ì§€ì›, í¼/ìŠ¤íŠ¸ë¦¬ë° í†µí•© |
| `async_bridge.rs` | ë©€í‹° ì—ì´ì „íŠ¸ ì§€ì› |
| `settings.rs` | ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ì„¤ì • ì¶”ê°€ |

---

## êµ¬í˜„ ìš°ì„ ìˆœìœ„

```
Phase G: Agent Dashboard     [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] í•„ìˆ˜
Phase H: Command Pipeline    [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] í•µì‹¬
Phase I: Context & History   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘] ì¤‘ìš”
Phase J: Multi-Agent         [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘] ê³ ê¸‰
Phase K: Advanced UI         [â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] ê°œì„ 
```

### ê¶Œì¥ ìˆœì„œ

1. **G â†’ H**: ê¸°ë³¸ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ì™„ì„±
2. **I**: ìƒì‚°ì„± í–¥ìƒ
3. **J â†’ K**: ê³ ê¸‰ ê¸°ëŠ¥

---

## ì˜ˆìƒ ì¼ì •

| Phase | ê¸°ê°„ | ëª©í‘œ |
|-------|------|------|
| G | 1ì£¼ | Agent Dashboard, Registry |
| H | 1ì£¼ | Command Pipeline, Queue |
| I | 1ì£¼ | History, Context Inspector |
| J | 1ì£¼ | Multi-Agent Support |
| K | 1ì£¼ | Advanced UI (Form, Streaming) |

**ì´ ì˜ˆìƒ: 5ì£¼**

---

## ì„±ê³µ ê¸°ì¤€

### Phase G ì™„ë£Œ ì‹œ
- [ ] ì—ì´ì „íŠ¸ ë™ì  ì¶”ê°€/ì œê±° ê°€ëŠ¥
- [ ] ì—°ê²° ìƒíƒœ ì‹œê°í™”
- [ ] ìƒíƒœ ë¨¸ì‹  ê¸°ë°˜ ì—°ê²° ê´€ë¦¬

### Phase H ì™„ë£Œ ì‹œ
- [ ] ëª…ë ¹ì–´ ìŠ¹ì¸ í ë™ì‘
- [ ] ìë™ ìŠ¹ì¸ ë ˆë²¨ ì„¤ì • ê°€ëŠ¥
- [ ] ëª…ë ¹ì–´ ìˆ˜ì • í›„ ì‹¤í–‰ ê°€ëŠ¥

### Phase I ì™„ë£Œ ì‹œ
- [ ] ì‹¤í–‰ íˆìŠ¤í† ë¦¬ ê²€ìƒ‰ ê°€ëŠ¥
- [ ] íˆìŠ¤í† ë¦¬ì—ì„œ ì¬ì‹¤í–‰ ê°€ëŠ¥
- [ ] í„°ë¯¸ë„ ì»¨í…ìŠ¤íŠ¸ ì‹œê°í™”

### Phase J ì™„ë£Œ ì‹œ
- [ ] 2ê°œ ì´ìƒ ì—ì´ì „íŠ¸ ë™ì‹œ ì—°ê²°
- [ ] ì—ì´ì „íŠ¸ ê°„ ì „í™˜ ê°€ëŠ¥
- [ ] ì—ì´ì „íŠ¸ ì²´ì´ë‹ ê°€ëŠ¥

### Phase K ì™„ë£Œ ì‹œ
- [ ] ìŠ¤í‚¤ë§ˆ ê¸°ë°˜ ë„êµ¬ í¼ ìë™ ìƒì„±
- [ ] ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ì‹¤ì‹œê°„ í‘œì‹œ
- [ ] ë·° ëª¨ë“œ ì „í™˜ UI

---

*ì‘ì„±ì¼: 2026-01-19*
*ë²„ì „: 1.0*
*ì´ì „ ë²„ì „: PRD-agterm-v1.1.md*
